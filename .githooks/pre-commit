#!/bin/sh

set -e

echo "Running Python checks..."

# Compile check
python3 -m compileall -q src tests

# Run tests if pytest is available
if python3 -c "import pytest" >/dev/null 2>&1; then
  python3 -m pytest -q
else
  echo "⚠️  pytest is not installed, skipping tests."
fi

# Run linter if ruff is available
if python3 -c "import ruff" >/dev/null 2>&1; then
  python3 -m ruff ruff format --diff --target-version=py311
  python3 -m ruff check --target-version=py311
else
  echo "⚠️  ruff is not installed, skipping lint."
fi

if python3 -c "import mypy" >/dev/null 2>&1; then
  python3 -m mypy src/ tests/ --python-version 3.11
else
  echo "⚠️  mypy is not installed, skipping lint."
fi

echo "✅ Checks passed. Commit proceeding."
